window.__require=function t(e,o,c){function r(a,i){if(!o[a]){if(!e[a]){var p=a.split("/");if(p=p[p.length-1],!e[p]){var l="function"==typeof __require&&__require;if(!i&&l)return l(p,!0);if(n)return n(p,!0);throw new Error("Cannot find module '"+a+"'")}a=p}var s=o[a]={exports:{}};e[a][0].call(s.exports,function(t){return r(e[a][1][t]||t)},s,s.exports,t,e,o,c)}return o[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<c.length;a++)r(c[a]);return r}({MapControl:[function(t,e,o){"use strict";cc._RF.push(e,"79777kgUFNH7IobLwg8lArh","MapControl");var c=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function c(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(c.prototype=o.prototype,new c)}}(),r=this&&this.__decorate||function(t,e,o,c){var r,n=arguments.length,a=n<3?e:null===c?c=Object.getOwnPropertyDescriptor(e,o):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,c);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a},n=cc._decorator,a=n.ccclass,i=n.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.map=null,e.mapContainer=null,e.scaleTime=null,e.maxScale=3,e.minScale=1,e.moveOffset=2,e.increaseRate=1e4,e.operLock=!1,e.isMoving=!1,e.mapTouchList=[],e.singleTouchCb=null,e}return c(e,t),e.prototype.start=function(){this.map||(this.map=this.node),this.mapContainer||(this.mapContainer=this.node.parent),this.addEvent()},e.prototype.addEvent=function(){var t=this;this.map.on(cc.Node.EventType.TOUCH_MOVE,function(e){if(!t.operLock)if(e.getTouches().filter(function(e){var o=cc.v2(e.getStartLocation().x,e.getStartLocation().y),c=t.mapContainer.convertToWorldSpaceAR(cc.Vec2.ZERO);return cc.rect(c.x-t.mapContainer.width/2,c.y-t.mapContainer.height/2,t.mapContainer.width,t.mapContainer.height).contains(o)}).forEach(function(e){0===t.mapTouchList.filter(function(t){return t.id===e.getID()}).length&&t.mapTouchList.push({id:e.getID(),touch:e})}),t.mapTouchList.length>=2)t.isMoving=!0,t.dealTouchData(t.mapTouchList,t.map);else if(1===t.mapTouchList.length){var o=t.mapTouchList[0].touch,c=cc.v2(o.getStartLocation()),r=cc.v2(o.getLocation());if((Math.abs(r.x-c.x)<=t.moveOffset||Math.abs(r.y-c.y)<=t.moveOffset)&&!t.isMoving)return;var n=cc.v2(o.getDelta());t.isMoving=!0,t.dealMove(n,t.map,t.mapContainer)}},this),this.map.on(cc.Node.EventType.TOUCH_END,function(e){if(t.operLock)return cc.log("operate is lock");if(t.mapTouchList.length<2){if(!t.isMoving){var o=cc.v2(e.getLocation()),c=t.map.convertToNodeSpaceAR(o);t.dealSelect(c)}t.isMoving=!1}t.removeTouchFromContent(e,t.mapTouchList)},this),this.map.on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.operLock||(t.mapTouchList.length<2&&(t.isMoving=!1),t.removeTouchFromContent(e,t.mapTouchList))},this),this.map.on(cc.Node.EventType.MOUSE_WHEEL,function(e){if(!t.operLock){var o=e.getLocation(),c=cc.v2(o.x,o.y),r=e.getScrollY(),n=t.map.scale+r/t.increaseRate,a=t.map,i=a.convertToNodeSpaceAR(c);t.smoothOperate(a,i,n)}},this)},e.prototype.removeTouchFromContent=function(t,e){for(var o=t.getTouches().map(function(t){return t.getID()}),c=e.length-1;c>=0;--c)o.indexOf(e[c].id)>-1&&e.splice(c,1)},e.prototype.smoothOperate=function(t,e,o){var c=o-t.scaleX,r=e.scale(cc.v2(c,c)),n=t.getPosition().sub(cc.v2(r.x,r.y));this.isOutRangeScale(o)||(o=(100*o|0)/100,t.scale=o,this.dealScalePos(n,t)),o=this.dealScaleRange(o),this.scaleTime.string=(100*o|0)+"%"},e.prototype.dealTouchData=function(t,e){var o=t[0].touch,c=t[1].touch,r=cc.v2(o.getDelta()),n=cc.v2(c.getDelta()),a=e.convertToNodeSpaceAR(cc.v2(o.getLocation())),i=e.convertToNodeSpaceAR(cc.v2(c.getLocation())),p=a.sub(i),l=r.sub(n),s=1;s=Math.abs(p.x)>Math.abs(p.y)?(p.x+l.x)/p.x*e.scaleX:(p.y+l.y)/p.y*e.scaleY;var u=i.add(cc.v2(p.x/2,p.y/2));this.smoothOperate(e,u,s)},e.prototype.isOutRangeScale=function(t){return t>this.maxScale||t<this.minScale},e.prototype.dealScaleRange=function(t){return t>this.maxScale?this.maxScale:t<this.minScale?this.minScale:t},e.prototype.dealScalePos=function(t,e){var o=this.mapContainer,c=o.convertToWorldSpaceAR(t),r=o.convertToNodeSpaceAR(c),n=this.calculateEdge(e,o,r);n.lBorderDelta>0&&(t.x-=n.lBorderDelta),n.rBorderDelta>0&&(t.x+=n.rBorderDelta),n.uBorderDelta>0&&(t.y+=n.uBorderDelta),n.dBorderDelta>0&&(t.y-=n.dBorderDelta),1===e.scale&&(t=cc.Vec2.ZERO),e.position=t},e.prototype.dealMove=function(t,e,o){var c=e.convertToWorldSpaceAR(cc.Vec2.ZERO),r=o.convertToNodeSpaceAR(c);r.x+=t.x,r.y+=t.y;var n=this.calculateEdge(e,o,r);n.lBorderDelta<=0&&n.rBorderDelta<=0&&(e.x+=t.x),n.uBorderDelta<=0&&n.dBorderDelta<=0&&(e.y+=t.y)},e.prototype.setSinglTouchCb=function(t){this.singleTouchCb=t},e.prototype.dealSelect=function(t){cc.log("click map on cc.v2("+t.x+", "+t.y+")"),this.singleTouchCb&&this.singleTouchCb(t)},e.prototype.calculateEdge=function(t,e,o){var c=t.width*t.scaleX,r=t.height*t.scaleY;return{lBorderDelta:o.x-c/2+e.width/2,rBorderDelta:e.width/2-(c/2+o.x),uBorderDelta:e.height/2-(r/2+o.y),dBorderDelta:o.y-r/2+e.height/2}},r([i({type:cc.Node,tooltip:"\u76ee\u6807\u8282\u70b9\uff0c\u5f53mapContainer\u4e3anull\u65f6\uff0c\u9700\u8981\u5c06\u8be5\u7ec4\u4ef6\u6302\u5728\u76ee\u6807\u8282\u70b9\uff0c\u8be5\u8282\u70b9\u9ed8\u8ba4\u4e3a\u6302\u8f7d\u8282\u70b9"})],e.prototype,"map",void 0),r([i({type:cc.Node,tooltip:"\u5f53\u8be5\u8282\u70b9\u4e3a\u7a7a\u65f6\uff0c\u9700\u8981\u5c06\u6539\u7ec4\u4ef6\u6302\u5728map\u8282\u70b9\u4e0a\uff0c\u8be5\u8282\u70b9\u9ed8\u8ba4\u4e3a\u6302\u8f7d\u8282\u70b9\u7684\u7236\u8282\u70b9"})],e.prototype,"mapContainer",void 0),r([i(cc.Label)],e.prototype,"scaleTime",void 0),r([i({tooltip:"\u56fe\u7247\u7f29\u653e\u6700\u5927scale"})],e.prototype,"maxScale",void 0),r([i({tooltip:"\u56fe\u7247\u7f29\u653e\u6700\u5c0fscale"})],e.prototype,"minScale",void 0),r([i({tooltip:"\u5355\u70b9\u89e6\u6478\u5bb9\u5fcd\u8bef\u5dee"})],e.prototype,"moveOffset",void 0),r([i({tooltip:"\u6eda\u8f6e\u7f29\u653e\u6bd4\u7387"})],e.prototype,"increaseRate",void 0),e=r([a],e)}(cc.Component);e.exports=p,cc._RF.pop()},{}],"use_v2.0.x_cc.Toggle_event":[function(t,e,o){"use strict";cc._RF.push(e,"b3f5c4JCYNAmrDklv+0dOf/","use_v2.0.x_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_check=!0),cc._RF.pop()},{}]},{},["MapControl","use_v2.0.x_cc.Toggle_event"]);